# 機能要件書: 3世代つながる認知症予防アプリ「脳活ファミリー」

> **ドキュメントバージョン**: 1.0.0
> **作成日**: 2026-02-15
> **Phase**: 1 - 要件定義
> **ステータス**: Draft

---

## 目次

1. [プロダクト概要](#1-プロダクト概要)
2. [機能要件](#2-機能要件)
3. [ユーザーストーリー](#3-ユーザーストーリー)
4. [画面一覧](#4-画面一覧)
5. [APIエンドポイント一覧](#5-apiエンドポイント一覧)
6. [データモデル](#6-データモデル)

---

## 1. プロダクト概要

### 1.1 ビジョン

**「離れていても、毎日つながる。脳を鍛えて、家族で笑おう。」**

認知症は65歳以上の約5人に1人が発症すると言われ、早期の予防的介入が最も効果的であることが科学的に示されている。しかし、認知機能トレーニングは単調になりがちで継続が難しく、特にシニア世代が一人で取り組むことは孤独感を伴う。

本アプリは、おじいちゃん・おばあちゃん、親世代、子供・孫世代の3世代が同じプラットフォーム上で認知機能テストをゲーム感覚で楽しみ、結果を共有し、励まし合うことで、認知症予防と家族のつながりの両方を実現する。

### 1.2 ミッション

- 認知機能の変化を早期に発見し、予防的な行動を促進する
- 世代を超えた家族のコミュニケーション頻度を高める
- 「孤独」という認知症の最大リスク因子を、家族のつながりで解消する
- 脳トレーニングを「義務」ではなく「楽しみ」に変える

### 1.3 ターゲットユーザー

| 世代 | 年齢層 | ペルソナ | 利用シーン | 主な動機 |
|------|--------|---------|-----------|---------|
| シニア世代 | 60-90歳 | 田中 花子さん(75歳)。一人暮らし。孫に会えるのが楽しみ。スマホは電話とLINEのみ使用 | 朝食後のルーティンとして5分間テスト | 認知症への不安、孫とのつながり |
| 親世代 | 30-60歳 | 田中 太郎さん(48歳)。共働き。離れて暮らす母の健康が心配 | 通勤中や昼休みに確認、週末にテスト | 親の健康管理、子供の教育 |
| 子供・孫世代 | 5-30歳 | 田中 さくらちゃん(10歳)。おばあちゃんが大好き。ゲームが得意 | 学校から帰宅後、おばあちゃんと一緒に | 楽しいゲーム、おばあちゃんとの競争 |

### 1.4 解決する課題

| 課題 | 現状 | 本アプリの解決策 |
|------|------|----------------|
| 認知機能低下の早期発見が困難 | 年1回の健康診断でしか測定機会がない | 毎日のテストで微細な変化を継続的に記録・可視化 |
| 脳トレの継続率が低い | 一人で取り組むと1週間で80%が離脱 | 家族との競争・励まし合いで継続率を向上 |
| 離れた家族の健康状態が把握しにくい | 電話で「元気?」と聞いても本当の状態がわからない | 客観的なスコアデータをリアルタイム共有 |
| シニアのデジタルデバイド | 複雑なアプリは使えない | 大きな文字、音声ガイド、最小限の操作で完結 |
| 世代間コミュニケーション不足 | 共通の話題がなく会話が続かない | テスト結果という共通の話題で自然な会話を生む |
| 孤独感による認知機能低下 | 一人暮らしのシニアは社会的孤立しやすい | 家族との日常的なデジタルコミュニケーション |

### 1.5 KPI

| 指標 | 目標値 | 測定方法 |
|------|--------|---------|
| DAU（日次アクティブユーザー） | ファミリーグループの70%が毎日アクセス | ログイン/テスト実行ログ |
| テスト完了率 | シニア世代: 85%以上 | デイリーチャレンジ開始→完了率 |
| 7日継続率 | 全世代: 60%以上 | 初回テスト後7日間の継続率 |
| 30日継続率 | 全世代: 40%以上 | 初回テスト後30日間の継続率 |
| 家族間メッセージ送信数 | 週平均5回/ファミリーグループ | メッセージ送信ログ |
| NPS（推奨度） | +40以上 | アプリ内アンケート |

---

## 2. 機能要件

### F-001: ユーザー管理・ファミリーグループ

#### F-001-01: ユーザー登録・認証

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | メールアドレスまたはSNS連携によるユーザー登録・ログイン |

**詳細仕様:**

- メールアドレス + パスワードによる登録
- Google / Apple / LINE によるソーシャルログイン
- パスワードリセット（メールリンク方式）
- セッション管理（リフレッシュトークン方式、30日間有効）
- シニア向け: ログイン状態を長期間維持（明示的なログアウトまで）
- 子供アカウント: 保護者の承認が必要（COPPA準拠）

**受け入れ条件:**

- [ ] メールアドレスでの新規登録が完了する
- [ ] ソーシャルログイン（Google/Apple/LINE）で登録・ログインできる
- [ ] パスワードリセットメールが送信され、リセットが完了する
- [ ] セッションが30日間維持される
- [ ] 13歳未満のアカウント作成時に保護者の同意フローが表示される

#### F-001-02: プロフィール設定

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | 年齢層に応じたプロフィール設定 |

**詳細仕様:**

- 表示名（ニックネーム）
- 生年月日（年齢層の自動判定に使用）
- アバター画像（プリセット10種 + カメラ撮影）
- 年齢層カテゴリ（自動判定 + 手動変更可）:
  - キッズ: 5-12歳
  - ジュニア: 13-19歳
  - スタンダード: 20-59歳
  - シニア: 60-74歳
  - シニアプラス: 75歳以上
- 続柄設定（おじいちゃん/おばあちゃん/お父さん/お母さん/息子/娘/孫 等）
- 利き手設定（テスト操作の最適化）

**受け入れ条件:**

- [ ] 必須項目（表示名、生年月日）を入力して保存できる
- [ ] 生年月日から年齢層が自動判定される
- [ ] アバターをプリセットから選択または撮影できる
- [ ] 続柄を設定できる

#### F-001-03: ファミリーグループ

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | 家族単位のグループ作成・メンバー管理 |

**詳細仕様:**

- ファミリーグループ作成（グループ名、アイコン設定）
- 招待方法:
  - QRコード表示 → スキャンで参加
  - 招待リンク生成 → LINE/メール等で共有
  - 招待コード（6桁英数字）入力
- 1ユーザーは最大3つのファミリーグループに参加可能
- 1ファミリーグループは最大15人まで
- グループ管理者（作成者）の権限:
  - メンバーの招待/削除
  - グループ設定変更
  - 通知設定管理
- メンバーの閲覧権限設定:
  - 全員公開（デフォルト）
  - 特定メンバーのみ公開
  - スコアのみ公開（詳細非公開）

**受け入れ条件:**

- [ ] ファミリーグループを作成できる
- [ ] QRコード、招待リンク、招待コードの3方式で招待できる
- [ ] 招待を受けたユーザーがグループに参加できる
- [ ] グループ管理者がメンバーを削除できる
- [ ] 閲覧権限を設定できる

#### F-001-04: シニア向けオンボーディング

| 項目 | 内容 |
|------|------|
| 優先度 | P1-High |
| 概要 | シニア世代がストレスなくアプリを使い始められる導入フロー |

**詳細仕様:**

- 大きな文字（最小18px、推奨24px）でのステップバイステップガイド
- 各ステップに音声ガイド付き（ON/OFF可能）
- 最大5ステップで完了:
  1. 「こんにちは！」- アプリの目的説明（30秒）
  2. お名前入力（キーボード入力 or 音声入力）
  3. 生年月日選択（大きなドラムロール式ピッカー）
  4. ファミリーグループ参加（QRスキャン or コード入力）
  5. 初回テスト体験（お試し3問）
- 「あとでやる」ボタンで各ステップをスキップ可能
- マスコットキャラクターが各ステップで声掛け

**受け入れ条件:**

- [ ] オンボーディングが5ステップ以内で完了する
- [ ] 各ステップで音声ガイドが再生される
- [ ] 文字サイズが18px以上である
- [ ] 各ステップでスキップが可能
- [ ] マスコットキャラクターが表示される

---

### F-002: 認知機能テスト（コアゲーム）

#### F-002-01: 記憶力テスト

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | 短期記憶・長期記憶を測定するテスト群 |

**テスト種別:**

**a) 絵合わせ（神経衰弱）**
- カードを裏返して同じ絵柄のペアを見つける
- 難易度別カード枚数:
  - キッズ: 2x3 (6枚/3ペア)
  - ジュニア: 3x4 (12枚/6ペア)
  - スタンダード: 4x4 (16枚/8ペア)
  - シニア: 3x4 (12枚/6ペア、ヒント付き)
  - チャレンジ: 4x5 (20枚/10ペア)
- 計測指標: ペア発見数、試行回数、所要時間
- 制限時間: 難易度に応じて60-180秒

**b) 単語記憶**
- 画面に表示される単語リストを記憶し、一定時間後に再現
- 難易度別単語数:
  - キッズ: 3単語（イラスト付き）
  - ジュニア: 5単語
  - スタンダード: 7単語
  - シニア: 5単語（カテゴリヒント付き）
  - チャレンジ: 10単語
- 表示時間: 単語数 x 3秒
- 計測指標: 正答数、順序正答率

**c) 物語記憶**
- 短い物語（3-5文）を読み/聞き、内容に関する質問に答える
- 難易度別文章量:
  - キッズ: 2文 + イラスト
  - ジュニア: 3文
  - スタンダード: 5文
  - シニア: 3文（音声読み上げ付き）
  - チャレンジ: 7文 + 詳細質問

**受け入れ条件:**

- [ ] 3種類の記憶力テストがすべてプレイできる
- [ ] 年齢層に応じて難易度が自動調整される
- [ ] スコアが正しく計算・記録される
- [ ] 制限時間内にアニメーション付きでカウントダウンが表示される
- [ ] シニアモードではヒントと音声読み上げが利用できる

#### F-002-02: 注意力テスト

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | 集中力・注意力を測定するテスト群 |

**テスト種別:**

**a) 間違い探し**
- 2つの似た画像から違いを見つける
- 難易度別の違い数:
  - キッズ: 3箇所（大きな違い）
  - ジュニア: 5箇所
  - スタンダード: 7箇所
  - シニア: 4箇所（ヒントゾーン付き）
  - チャレンジ: 10箇所（微細な違い）
- 制限時間: 60-120秒

**b) 色判別（ストループテスト）**
- 文字の「意味」と「色」が異なる場合に正しい色を答える
- 例: 「あか」と青色で表示 → 正解は「青」
- 制限時間: 1問3秒、計20問

**c) 反応速度テスト**
- 画面に特定のマークが現れたらタップ
- ただし、別のマーク（おとり）には反応しない
- 計測指標: 平均反応時間、正答率、誤タップ率

**受け入れ条件:**

- [ ] 3種類の注意力テストがすべてプレイできる
- [ ] 反応速度がミリ秒単位で正確に測定される
- [ ] ストループテストで正しい色と文字の組み合わせが表示される
- [ ] 間違い探しでタップ位置が正しく判定される

#### F-002-03: 言語力テスト

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | 語彙力・言語処理能力を測定するテスト群 |

**テスト種別:**

**a) しりとり（AI対戦）**
- AIとしりとり対決
- 制限時間: 1ターン15秒
- 使用済みの単語は再使用不可
- 難易度調整: AIの語彙レベルと応答速度

**b) 文字並べ替え（アナグラム）**
- バラバラになった文字を正しい単語に並べ替え
- 難易度別文字数:
  - キッズ: 2-3文字（ひらがな）
  - ジュニア: 4-5文字
  - スタンダード: 5-6文字
  - シニア: 3-4文字（ヒント付き）
  - チャレンジ: 6-8文字（漢字混在）

**c) 連想ゲーム**
- 提示されたキーワードから関連する単語を制限時間内にできるだけ多く入力
- 例: 「赤い」→ りんご、トマト、信号、血...
- 制限時間: 60秒
- 音声入力対応

**受け入れ条件:**

- [ ] しりとりでAIが適切な難易度で応答する
- [ ] 文字並べ替えで正解判定が正しく動作する
- [ ] 連想ゲームで音声入力が使用できる
- [ ] 日本語の語彙データベースが適切に機能する

#### F-002-04: 計算力テスト

| 項目 | 内容 |
|------|------|
| 優先度 | P1-High |
| 概要 | 数的処理能力を測定するテスト群 |

**テスト種別:**

**a) 暗算チャレンジ**
- 四則演算の問題を制限時間内に解答
- 難易度別:
  - キッズ: 1桁の足し算・引き算
  - ジュニア: 2桁の四則演算
  - スタンダード: 3桁の四則演算
  - シニア: 2桁の足し算・引き算（大きな表示）
  - チャレンジ: 複合演算（括弧付き）
- 1問あたり制限時間: 5-15秒

**b) 数列パターン**
- 数列の規則性を見つけて次の数を答える
- 例: 2, 4, 8, 16, ? → 32
- 難易度別パターン複雑度を調整

**受け入れ条件:**

- [ ] 暗算問題が年齢層に応じた難易度で出題される
- [ ] 数列パターンの正解判定が正しい
- [ ] 回答入力がテンキーUIで快適にできる

#### F-002-05: 空間認識テスト

| 項目 | 内容 |
|------|------|
| 優先度 | P1-High |
| 概要 | 空間把握能力を測定するテスト群 |

**テスト種別:**

**a) ジグソーパズル**
- 画像をピースに分割し、元の配置に戻す
- 難易度別ピース数:
  - キッズ: 4ピース
  - ジュニア: 9ピース
  - スタンダード: 16ピース
  - シニア: 6ピース（ガイドライン付き）
  - チャレンジ: 25ピース
- ドラッグ&ドロップ操作

**b) 図形回転**
- 提示された図形を回転させた時の正しい形を選ぶ
- 2D回転と3D回転（難易度による）
- 4択形式

**受け入れ条件:**

- [ ] パズルピースのドラッグ&ドロップがスムーズに動作する
- [ ] 図形回転の選択肢が正しく生成される
- [ ] タッチ操作とマウス操作の両方に対応する

#### F-002-06: 難易度自動調整システム

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | ユーザーのパフォーマンスに基づく動的難易度調整 |

**詳細仕様:**

- 初回テスト時に年齢層ベースの初期難易度を設定
- 直近5回のテスト結果に基づくアダプティブ調整:
  - 正答率80%以上が3回連続 → 1段階UP
  - 正答率40%以下が2回連続 → 1段階DOWN
- 5段階の難易度レベル:
  1. キッズ（5-12歳基準）
  2. ジュニア（13-19歳基準）
  3. スタンダード（20-59歳基準）
  4. シニア（60歳以上基準、ヒント・補助付き）
  5. チャレンジ（全年齢高難度）
- 手動での難易度変更も可能
- カテゴリ別に異なる難易度を保持（記憶力はレベル3、計算はレベル2、等）

**受け入れ条件:**

- [ ] 初回テストで年齢に応じた難易度が設定される
- [ ] 正答率に基づいて難易度が自動調整される
- [ ] カテゴリ別に異なる難易度が維持される
- [ ] 手動で難易度を変更できる

#### F-002-07: デイリーチャレンジ

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | 毎日5分程度の日課テスト |

**詳細仕様:**

- 毎日0:00にリセット、新しいチャレンジが生成
- 構成: 5カテゴリから各1問ずつ、計5問（約5分）
- 完了するとデイリースコアが算出される
- カレンダービューで実施状況を表示（実施済み=花マーク）
- 連続実施日数のカウント表示
- テスト未実施でもアプリを開くことで「出席」記録

**受け入れ条件:**

- [ ] 毎日新しいチャレンジが生成される
- [ ] 5分以内で完了できる
- [ ] カレンダーに実施状況が表示される
- [ ] 連続日数が正しくカウントされる

#### F-002-08: ウィークリーチャレンジ

| 項目 | 内容 |
|------|------|
| 優先度 | P2-Medium |
| 概要 | 週1回の総合テスト |

**詳細仕様:**

- 毎週月曜日に新しいウィークリーチャレンジが解放
- 構成: 全5カテゴリから各3問、計15問（約15分）
- 途中中断・再開が可能
- ウィークリースコアはデイリーより重み付けを高く設定
- ファミリーランキングに反映
- 実施期限: その週の日曜23:59まで

**受け入れ条件:**

- [ ] 毎週月曜日に新しいチャレンジが生成される
- [ ] 途中中断しても進捗が保存される
- [ ] ウィークリースコアがランキングに反映される

---

### F-003: スコアリング・記録システム

#### F-003-01: 認知機能スコア算出

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | テスト結果から5カテゴリ別の認知機能スコアを算出 |

**詳細仕様:**

- 5カテゴリ別スコア（各0-100点）:
  1. **記憶力** (Memory): 正答率 x 速度補正 x 難易度補正
  2. **注意力** (Attention): 正答率 x 反応速度 x 持続性
  3. **言語力** (Language): 語彙量 x 応答速度 x 正確性
  4. **計算力** (Calculation): 正答率 x 速度 x 難易度
  5. **空間認識** (Spatial): 正答率 x 操作効率 x 難易度
- 総合スコア: 5カテゴリの加重平均（均等配分がデフォルト）
- 年齢補正: 年齢層別の基準値と比較した偏差値形式の表示
- スコア表示: 数値 + 5段階評価（とてもよい/よい/ふつう/がんばろう/もう少し）
- シニア向け: ネガティブな表現を避け、すべてポジティブな文言で表示

**受け入れ条件:**

- [ ] 5カテゴリ別にスコアが算出される
- [ ] 総合スコアが正しく計算される
- [ ] 年齢層別の評価が適切に表示される
- [ ] シニア向けにポジティブな表現で結果が表示される

#### F-003-02: 推移グラフ

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | スコアの時系列変化を視覚化 |

**詳細仕様:**

- 表示期間切り替え: 1週間 / 1ヶ月 / 3ヶ月 / 6ヶ月 / 1年
- グラフ種別:
  - 折れ線グラフ: 総合スコアの推移
  - カテゴリ別折れ線グラフ: 各カテゴリの推移
  - レーダーチャート: 5カテゴリの能力バランス（五角形）
  - 棒グラフ: 日別のテスト実施状況
- インタラクション:
  - タップで詳細値の表示
  - ピンチズームでの期間拡大・縮小
  - 横スクロールでの時間移動
- トレンド表示:
  - 上昇トレンド: 緑色の矢印
  - 安定: 青色の横矢印
  - 下降トレンド: オレンジ色の矢印（赤は使用しない）
- シニア向け: 大きな数字、シンプルな色分け

**受け入れ条件:**

- [ ] 日次・週次・月次でグラフが切り替えられる
- [ ] レーダーチャートが5角形で表示される
- [ ] トレンドが矢印で直感的に表示される
- [ ] グラフのタップ操作で詳細値が表示される

#### F-003-03: 年齢別平均比較

| 項目 | 内容 |
|------|------|
| 優先度 | P2-Medium |
| 概要 | 同年齢層の平均スコアとの比較表示 |

**詳細仕様:**

- 同年齢層（5歳刻み）の平均スコアを背景に表示
- 偏差値的な位置づけ（上位何%に相当するか）
- プライバシー配慮: 個人を特定できない集計データのみ使用
- データ不足時（ユーザー数が少ない年齢層）: 「データ収集中」と表示

**受け入れ条件:**

- [ ] 同年齢層の平均と自分のスコアが比較できる
- [ ] 個人を特定できるデータは表示されない

#### F-003-04: トレンドアラート

| 項目 | 内容 |
|------|------|
| 優先度 | P1-High |
| 概要 | 認知機能スコアの急激な変化を検知し通知 |

**詳細仕様:**

- 検知条件:
  - 直近2週間の平均スコアが、前月比で15%以上低下
  - 特定カテゴリが3回連続で過去最低を記録
  - 7日以上テスト未実施
- 通知先:
  - 本人: アプリ内通知（やさしい文面）
  - ファミリーグループ管理者: プッシュ通知
  - 設定した家族メンバー: メール通知（オプション）
- 文面例:
  - 本人向け: 「最近少しお疲れかもしれません。ゆっくり休んでからまた挑戦しましょう！」
  - 家族向け: 「花子さんの記憶力スコアに変化が見られます。声をかけてみませんか？」

**受け入れ条件:**

- [ ] スコア低下時にアラートが生成される
- [ ] 家族への通知が適切に送信される
- [ ] 本人向けの文面がポジティブである
- [ ] 通知設定で受信ON/OFFが切り替えられる

---

### F-004: ファミリーダッシュボード

#### F-004-01: 家族スコア一覧

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | ファミリーグループ全員の今日の状態を一覧表示 |

**詳細仕様:**

- カード形式でメンバーを一覧表示:
  - アバター画像
  - 表示名（続柄）
  - 今日のテスト実施状況（済/未）
  - 直近のスコアとトレンド矢印
  - 最終アクティブ時刻
- 「今日の調子」アイコン:
  - 太陽: スコア上昇中
  - 晴れ時々曇り: 安定
  - 曇り: やや低下（「赤信号」的表現は避ける）
- リアルタイム更新（WebSocket or ポーリング30秒間隔）

**受け入れ条件:**

- [ ] ファミリーメンバー全員がカード形式で表示される
- [ ] テスト実施状況がリアルタイムで反映される
- [ ] 「今日の調子」アイコンが正しく表示される

#### F-004-02: ファミリーランキング

| 項目 | 内容 |
|------|------|
| 優先度 | P1-High |
| 概要 | 家族内の楽しいランキング表示 |

**詳細仕様:**

- ランキング種別:
  - 今日のスコアランキング
  - 今週の合計スコアランキング
  - 連続日数ランキング
  - カテゴリ別チャンピオン
- 表示形式:
  - 1位: 金の王冠 + 紙吹雪アニメーション
  - 2位: 銀の王冠
  - 3位: 銅の王冠
  - 4位以下: 順位番号
- 世代別ハンディキャップ: 年齢補正値を適用したランキングモード
- 盛り上げ演出: 順位が入れ替わった時にアニメーション通知

**受け入れ条件:**

- [ ] 各種ランキングが正しく集計される
- [ ] 王冠アイコンとアニメーションが表示される
- [ ] 年齢補正付きランキングが選択できる

#### F-004-03: 世代対抗戦

| 項目 | 内容 |
|------|------|
| 優先度 | P2-Medium |
| 概要 | 世代チームに分かれての対抗戦モード |

**詳細仕様:**

- 自動チーム分け:
  - シニアチーム（60歳以上）
  - 親チーム（20-59歳）
  - キッズチーム（19歳以下）
- チームスコア: メンバー平均スコアで計算
- 週単位の対抗戦期間
- 勝利チームにはボーナスポイント + 特別バッジ
- 少人数チームの救済: 1人チームの場合、スコア×1.2補正

**受け入れ条件:**

- [ ] 世代ごとにチームが自動構成される
- [ ] チーム対抗のスコアが正しく集計される
- [ ] 勝利チームに特別バッジが付与される

---

### F-005: コミュニケーション機能

#### F-005-01: 励ましメッセージ

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | ワンタップでファミリーメンバーに気持ちを送れる |

**詳細仕様:**

- スタンプカテゴリ（各8-12種）:
  - 励まし: 「がんばって！」「すごい！」「応援してるよ！」
  - お祝い: 「おめでとう！」「新記録！」「やったね！」
  - あいさつ: 「おはよう」「おやすみ」「元気？」
  - 感情: 笑顔、拍手、ハート、ガッツポーズ
- マスコットキャラクター付きスタンプ
- テスト結果画面からワンタップで送信
- ダッシュボードのメンバーカードからワンタップで送信
- 受信時: バナー通知 + アプリ内ポップアップ

**受け入れ条件:**

- [ ] スタンプ一覧から選択して送信できる
- [ ] 受信側にプッシュ通知が届く
- [ ] テスト結果画面から直接送信できる

#### F-005-02: ボイスメッセージ

| 項目 | 内容 |
|------|------|
| 優先度 | P1-High |
| 概要 | 短い音声メッセージの送受信 |

**詳細仕様:**

- 録音: 最大30秒
- 再生: 音声波形のビジュアライザー付き
- 録音操作: ボタン長押しで録音、離して送信
- 再生速度: 1x / 0.8x（ゆっくり再生）
- 保存期間: 30日間
- ファイルサイズ: 最大500KB（圧縮）
- シニア向け: 大きな録音ボタン、再生ボタン

**受け入れ条件:**

- [ ] 30秒以内の音声を録音・送信できる
- [ ] 受信した音声を再生できる
- [ ] ゆっくり再生（0.8x）が使用できる

#### F-005-03: 自動通知

| 項目 | 内容 |
|------|------|
| 優先度 | P1-High |
| 概要 | テスト完了時の自動通知 |

**詳細仕様:**

- 通知トリガー:
  - テスト完了: 「花子さんがデイリーチャレンジを完了しました！スコア: 85点」
  - 新記録達成: 「太郎さんが記憶力で新記録を達成！」
  - 連続記録更新: 「さくらちゃんが10日連続達成！」
  - バッジ獲得: 「花子さんが『1ヶ月マスター』バッジを獲得！」
- 通知チャネル:
  - アプリ内通知（常時）
  - プッシュ通知（設定に応じて）
- 通知頻度制限: 1メンバーあたり1日最大5通（スパム防止）

**受け入れ条件:**

- [ ] テスト完了時にファミリーメンバーに通知される
- [ ] 新記録・連続記録で特別な通知が送信される
- [ ] 通知頻度が1日5通に制限される

#### F-005-04: 家族写真共有

| 項目 | 内容 |
|------|------|
| 優先度 | P3-Low |
| 概要 | テスト結果カードと一緒に写真を共有 |

**詳細仕様:**

- テスト完了後に写真撮影 or ライブラリから選択
- テスト結果カード（スコア + キャラクター）にオーバーレイ
- ファミリーグループのタイムラインに投稿
- リアクション（ハート、笑顔等）機能

**受け入れ条件:**

- [ ] 写真とテスト結果を組み合わせて共有できる
- [ ] タイムラインで閲覧できる
- [ ] リアクションが付けられる

#### F-005-05: ビデオ通話連携

| 項目 | 内容 |
|------|------|
| 優先度 | P3-Low |
| 概要 | 外部ビデオ通話アプリへのディープリンク |

**詳細仕様:**

- ファミリーメンバーのプロフィールから「ビデオ通話」ボタン
- 連携先: LINE通話、FaceTime、Google Meet
- アプリ未インストール時は代替リンク表示
- 通話履歴は記録しない（プライバシー配慮）

**受け入れ条件:**

- [ ] ビデオ通話ボタンから外部アプリが起動する
- [ ] 複数の通話アプリに対応する

---

### F-006: キャラクター・ゲーミフィケーション

#### F-006-01: マスコットキャラクター

| 項目 | 内容 |
|------|------|
| 優先度 | P1-High |
| 概要 | アプリ全体を通じてユーザーを励ます可愛いキャラクター |

**詳細仕様:**

- メインキャラクター: 「のうたん」（フクロウの赤ちゃん）
  - フクロウ = 知恵の象徴
  - 赤ちゃん = 親しみやすさ
  - 表情パターン: 通常、喜び、応援、眠い、びっくり、がんばれ（計8パターン）
- 表示シーン:
  - ホーム画面: 挨拶（時間帯で変化）
  - テスト前: 「いっしょにがんばろう！」
  - テスト中: 応援表情
  - テスト後: 結果に応じたリアクション
  - 通知: キャラクター付き通知
- ボイス:
  - テスト開始: 「レッツゴー！」
  - 正解時: 「すごい！」
  - テスト完了: 「おつかれさま！」
- アニメーション: motion/react でのスムーズなモーション
  - idle: ゆらゆら揺れる（ループ）
  - happy: ジャンプ + 星エフェクト
  - cheer: 手を振る

**受け入れ条件:**

- [ ] マスコットキャラクターがホーム画面に表示される
- [ ] 時間帯・状況に応じた表情変化がある
- [ ] アニメーションがスムーズに再生される

#### F-006-02: 連続ログインボーナス

| 項目 | 内容 |
|------|------|
| 優先度 | P1-High |
| 概要 | 継続利用を促す報酬システム |

**詳細仕様:**

- ログインボーナス:
  - 1日目: 10コイン
  - 2日目: 15コイン
  - 3日目: 20コイン
  - 4日目: 25コイン
  - 5日目: 30コイン
  - 6日目: 35コイン
  - 7日目: 50コイン + スペシャルスタンプ
- コインの用途: キャラクター着せ替えアイテムの解放
- 連続記録が途切れた場合: 1日目からリスタート（ただし過去最高記録は保持）
- ログインカレンダー: 当月の出席状況を花柄で視覚化

**受け入れ条件:**

- [ ] 日次ログインでコインが付与される
- [ ] 7日目にスペシャルボーナスが付与される
- [ ] ログインカレンダーが正しく表示される

#### F-006-03: バッジ・実績システム

| 項目 | 内容 |
|------|------|
| 優先度 | P1-High |
| 概要 | 達成感を与えるバッジコレクション |

**詳細仕様:**

- バッジカテゴリ:
  - **継続系**: 7日連続、30日連続、100日連続、365日連続
  - **スコア系**: 初めての90点以上、5カテゴリ全て80点以上、最高スコア更新10回
  - **ファミリー系**: 家族全員が同日にテスト完了、家族に10回励ましを送った、世代対抗戦初勝利
  - **季節系**: 正月チャレンジ完了、ひな祭りイベント参加、こどもの日チャレンジ
  - **特別系**: 初めてのテスト完了、全カテゴリテスト体験、ウィークリーチャレンジ初完了
- バッジデザイン: ゴールド/シルバー/ブロンズの3段階
- バッジ獲得時: 紙吹雪アニメーション + キャラクター祝福
- プロフィールにバッジコレクション表示

**受け入れ条件:**

- [ ] 条件達成時にバッジが自動付与される
- [ ] バッジ獲得時にアニメーションが表示される
- [ ] プロフィールでバッジコレクションが閲覧できる

#### F-006-04: キャラクター着せ替え

| 項目 | 内容 |
|------|------|
| 優先度 | P2-Medium |
| 概要 | コインで解放するキャラクターカスタマイズ |

**詳細仕様:**

- カスタマイズ要素:
  - 帽子（10種）
  - アクセサリー（10種）
  - 背景（8種）
  - 特殊エフェクト（5種）
- 解放コスト: 50-200コイン
- 季節限定アイテム（期間限定で解放可能）
- 着せ替えたキャラクターはプロフィールに反映

**受け入れ条件:**

- [ ] コインで着せ替えアイテムを解放できる
- [ ] キャラクターにアイテムを装着できる
- [ ] 装着状態がプロフィールに反映される

#### F-006-05: 季節イベント

| 項目 | 内容 |
|------|------|
| 優先度 | P2-Medium |
| 概要 | 日本の季節行事に合わせた特別イベント |

**詳細仕様:**

- イベントスケジュール:
  - 1月: お正月チャレンジ（書き初めテーマ）
  - 2月: バレンタインイベント
  - 3月: ひな祭りイベント
  - 5月: こどもの日チャレンジ
  - 7月: 七夕イベント
  - 8月: 夏祭りイベント
  - 9月: 敬老の日スペシャル
  - 12月: クリスマスイベント
- イベント内容:
  - テーマに沿った特別問題
  - 限定バッジ
  - 限定着せ替えアイテム
  - ファミリー共同ミッション

**受け入れ条件:**

- [ ] 季節に合わせたイベントが表示される
- [ ] 限定問題が出題される
- [ ] 限定バッジ・アイテムが獲得できる

---

### F-007: ヘルスレポート

#### F-007-01: 月次レポート生成

| 項目 | 内容 |
|------|------|
| 優先度 | P1-High |
| 概要 | 1ヶ月の認知機能データをまとめたレポート |

**詳細仕様:**

- 生成タイミング: 毎月1日に前月分を自動生成
- レポート内容:
  - 月間総合スコアの推移
  - 5カテゴリ別の変化
  - 前月比較（改善/悪化の分析）
  - テスト実施日数
  - 最もスコアが高かったカテゴリ
  - 改善が見られたカテゴリ
  - 推奨アクション（「記憶力テストを重点的に取り組みましょう」等）
- 出力形式:
  - アプリ内閲覧
  - PDF出力
  - メール送信
- 医療専門家向けフォーマット: 日本の認知症スクリーニングに準じたスコア表記

**受け入れ条件:**

- [ ] 毎月自動でレポートが生成される
- [ ] PDF形式でダウンロードできる
- [ ] メールで送信できる
- [ ] 医療向けフォーマットが選択できる

#### F-007-02: 早期警告システム

| 項目 | 内容 |
|------|------|
| 優先度 | P1-High |
| 概要 | 認知機能の急な変化を検知し家族に通知 |

**詳細仕様:**

- 検知アルゴリズム:
  - 2週間移動平均と4週間移動平均のクロス（ゴールデンクロス/デッドクロス）
  - カテゴリ別の標準偏差逸脱（2σ以上の変化）
  - テスト未実施日数の異常検知（通常パターンからの逸脱）
- 警告レベル:
  - 注意（黄色）: 1カテゴリで軽度の変化
  - 警戒（オレンジ）: 複数カテゴリで中度の変化
  - 要確認（目立たない赤）: 総合スコアの顕著な低下
- 通知先: ファミリーグループの管理者（親世代を想定）
- 誤検知対策: 一時的な体調不良を考慮し、3日間の猶予期間

**受け入れ条件:**

- [ ] スコアの急変が正しく検知される
- [ ] 警告レベルに応じた通知が送信される
- [ ] 3日間の猶予期間が適用される
- [ ] 通知が管理者にのみ送信される

---

### F-008: アクセシビリティ

#### F-008-01: 視覚アクセシビリティ

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | 視覚に制約のあるユーザーへの対応 |

**詳細仕様:**

- 文字サイズ設定:
  - 小: 14px（デフォルト非シニア）
  - 中: 18px（デフォルトシニア）
  - 大: 24px
  - 特大: 32px
- 高コントラストモード:
  - コントラスト比: 最低7:1（AAA準拠）
  - 背景: 濃い色、文字: 明るい色
- 色覚多様性対応:
  - 色だけに依存しない情報伝達（パターン・形状の併用）
  - 色覚シミュレーションテスト済み
- ダークモード対応

**受け入れ条件:**

- [ ] 4段階の文字サイズが切り替えられる
- [ ] 高コントラストモードでコントラスト比7:1以上
- [ ] 色覚多様性対応が実装されている
- [ ] ダークモードが利用できる

#### F-008-02: 操作アクセシビリティ

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | 操作が困難なユーザーへの対応 |

**詳細仕様:**

- タッチターゲット: 最小44px x 44px（WCAG 2.5.5準拠）
- ボタン間隔: 最小8px
- 誤タップ防止: ダブルタップ確認（重要な操作のみ）
- 音声読み上げ:
  - すべてのUIテキストにaria-label設定
  - テスト問題の読み上げ対応
  - 結果の読み上げ対応
- 音声入力:
  - 言語テストでの音声回答
  - 検索・入力フィールドでの音声入力
- シンプルUIモード:
  - 不要な装飾を排除
  - 大きなボタンのみの画面構成
  - 操作ステップの最小化

**受け入れ条件:**

- [ ] すべてのタッチターゲットが44px以上
- [ ] VoiceOver/TalkBackでの操作が可能
- [ ] 音声入力で回答できるテストがある
- [ ] シンプルUIモードが利用できる

---

### F-009: 通知・リマインダー

#### F-009-01: テストリマインダー

| 項目 | 内容 |
|------|------|
| 優先度 | P1-High |
| 概要 | 毎日のテスト実施を促すリマインダー |

**詳細仕様:**

- リマインダー時刻: ユーザーが設定（デフォルト: 朝9:00）
- 文面バリエーション:
  - 「おはようございます！今日も脳トレの時間ですよ」
  - 「のうたんが待ってるよ！一緒に脳トレしよう」
  - 「今日のチャレンジが届いています！5分だけ頑張ってみよう」
- リマインダー頻度:
  - 1日1回（デフォルト）
  - テスト未実施の場合のみ2回目（3時間後）
- 曜日別ON/OFF設定

**受け入れ条件:**

- [ ] 設定した時刻にリマインダーが届く
- [ ] テスト実施済みの場合は2回目が送信されない
- [ ] 曜日別にON/OFFを設定できる

#### F-009-02: 家族見守り通知

| 項目 | 内容 |
|------|------|
| 優先度 | P1-High |
| 概要 | シニアメンバーの活動状況を家族に通知 |

**詳細仕様:**

- 通知トリガー:
  - 「花子さんが今日のテストを完了しました」（テスト完了時）
  - 「花子さんが今日まだテストしていません」（設定時刻に未実施の場合）
  - 「花子さんが3日間アプリを開いていません」（未アクティブ検知）
- 通知設定:
  - 通知対象メンバーの選択
  - 通知タイミングの設定
  - 通知チャネルの選択（プッシュ/メール）
- プライバシー配慮:
  - シニア本人に「家族に通知が行きます」を明示
  - 通知内容の詳細度を設定可能

**受け入れ条件:**

- [ ] テスト完了/未完了が家族に通知される
- [ ] 長期未アクティブが検知・通知される
- [ ] シニア本人に通知設定が明示される

---

### F-010: データ・プライバシー

#### F-010-01: データ暗号化

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | ヘルスデータの保護 |

**詳細仕様:**

- 転送中の暗号化: TLS 1.3
- 保存時の暗号化: AES-256
- 認知機能スコアは健康データとして特別保護対象
- ローカルストレージ: IndexedDBの暗号化
- バックアップ: 暗号化された状態で保存

**受け入れ条件:**

- [ ] すべての通信がTLS 1.3で暗号化される
- [ ] 保存データがAES-256で暗号化される
- [ ] ローカルデータが暗号化される

#### F-010-02: プライバシー管理

| 項目 | 内容 |
|------|------|
| 優先度 | P0-Critical |
| 概要 | 個人情報保護法・GDPR準拠のデータ管理 |

**詳細仕様:**

- プライバシーポリシー表示・同意
- データ収集の透明性:
  - 収集するデータの一覧表示
  - 各データの利用目的の説明
  - 第三者提供の有無
- ユーザー権利:
  - データアクセス権: 自分のデータをすべて閲覧
  - データポータビリティ: JSON/CSV形式でエクスポート
  - 削除権: アカウント削除とともに全データ削除
  - 同意撤回: いつでもデータ収集の同意を撤回可能
- 家族間データ共有:
  - 閲覧権限の粒度設定（スコアのみ/詳細含む/非公開）
  - 共有データの範囲設定

**受け入れ条件:**

- [ ] プライバシーポリシーが表示・同意できる
- [ ] データエクスポート（JSON/CSV）が実行できる
- [ ] アカウント削除で全データが削除される
- [ ] 家族間の閲覧権限が設定できる

---

## 3. ユーザーストーリー

### US-001: シニアの毎朝のルーティン

> **ペルソナ**: 花子さん（75歳、一人暮らし）
> **ストーリー**: 花子さんは毎朝食後にアプリを開く。のうたんが「おはようございます、花子さん！今日も一緒にがんばりましょう！」と出迎えてくれる。デイリーチャレンジの5問を大きな文字で解いていく。記憶力テストで少し迷ったが、ヒントを使って正解。完了すると「今日のスコア: 82点！昨日より3点UP！」と表示され、のうたんが喜ぶアニメーション。孫のさくらちゃんに「おばあちゃんがんばったね！」スタンプが届く。

**関連機能**: F-001-04, F-002-07, F-003-01, F-005-01, F-006-01

### US-002: 親世代の見守りダッシュボード確認

> **ペルソナ**: 太郎さん（48歳、共働き）
> **ストーリー**: 太郎さんは通勤電車の中でアプリを開く。ファミリーダッシュボードで母・花子さんの今日の状態を確認。「今日のテスト完了済み、スコア82点、上昇トレンド」と表示されて安心する。太陽マークが出ていて調子が良さそうだ。「すごいね、お母さん！」とスタンプを送る。ランキングを見ると娘のさくらに負けているので、昼休みにテストをやろうと思う。

**関連機能**: F-004-01, F-003-02, F-005-01, F-004-02

### US-003: 子供と祖父母の世代対抗戦

> **ペルソナ**: さくらちゃん（10歳）
> **ストーリー**: 学校から帰ってきたさくらちゃんがアプリを開くと、「今週の世代対抗戦！キッズチーム vs シニアチーム」が表示されている。おばあちゃんチームに負けたくないので、真剣にチャレンジ。計算テストで満点を取って「やった！」と大喜び。おばあちゃんに「さくらちゃんすごいね！おばあちゃんも負けないよ！」とボイスメッセージが届く。

**関連機能**: F-004-03, F-002-04, F-005-02, F-006-03

### US-004: テスト未実施の見守り通知

> **ペルソナ**: 太郎さん（48歳）
> **ストーリー**: 夕方、太郎さんのスマホに「花子さんが今日まだテストしていません」という通知が届く。「体調でも悪いのかな？」と心配になり、アプリからおばあちゃんにボイスメッセージ「お母さん、元気？今日のテストまだだよ〜、一緒にやろうよ」と送る。花子さんはメッセージを聞いて嬉しくなり、すぐにテストを始める。

**関連機能**: F-009-02, F-005-02, F-002-07

### US-005: 月次レポートの医師共有

> **ペルソナ**: 花子さん（75歳）と太郎さん（48歳）
> **ストーリー**: 月初に花子さんの月次レポートが生成される。太郎さんがPDFをダウンロードし、かかりつけ医に見せる。医師は「記憶力は安定していますが、注意力が少し低下傾向ですね。日常生活で気をつけることを提案します」とアドバイス。太郎さんは安心すると同時に、注意力テストの重要性を理解する。

**関連機能**: F-007-01, F-003-02, F-003-04

### US-006: 連続ログインとバッジ獲得

> **ペルソナ**: 花子さん（75歳）
> **ストーリー**: 花子さんが30日連続でテストを完了。のうたんが特別なアニメーションで「おめでとうございます！30日連続達成！」と祝福。「30日マスター」の金バッジが授与される。ファミリーグループに「花子さんが30日マスターバッジを獲得！」と通知され、家族全員からお祝いスタンプが届く。花子さんは「明日も頑張ろう」と笑顔になる。

**関連機能**: F-006-02, F-006-03, F-005-03, F-005-01

### US-007: シニアの初回オンボーディング

> **ペルソナ**: 花子さん（75歳）
> **ストーリー**: 息子の太郎さんにアプリをインストールしてもらった花子さん。アプリを開くと大きな文字で「こんにちは！」とのうたんが挨拶。音声ガイドで「画面をタップしてお名前を入力してください」と案内される。名前を入力し、生年月日を大きなドラムロールで選択。太郎さんが見せてくれたQRコードをスキャンしてファミリーグループに参加。お試し問題を3問解いて「上手にできましたね！」と褒められる。全部で3分で完了。

**関連機能**: F-001-04, F-001-03, F-008-02

### US-008: 早期警告からの家族のアクション

> **ペルソナ**: 太郎さん（48歳）
> **ストーリー**: 太郎さんのスマホに「花子さんの記憶力スコアに変化が見られます。声をかけてみませんか？」というオレンジ色の通知が届く。ダッシュボードを確認すると、2週間前から記憶力のスコアが徐々に下降している。太郎さんはすぐにビデオ通話を開始。花子さんと話すと「最近眠れなくて…」という。太郎さんは月次レポートを持って花子さんの主治医に相談することにする。

**関連機能**: F-007-02, F-003-04, F-005-05, F-007-01

### US-009: ファミリーランキングの盛り上がり

> **ペルソナ**: 田中家全員（花子75歳、太郎48歳、妻のゆり45歳、さくら10歳、弟のこうた7歳）
> **ストーリー**: 日曜の夜、家族LINEグループで「今週のランキング発表だよ！」と太郎さん。アプリを開くと、1位はさくらちゃん（年齢補正なし）。年齢補正ありランキングでは花子おばあちゃんが1位。「おばあちゃんすごーい！」「こうたにも負けないよ！」とチャットが盛り上がる。来週の世代対抗戦に向けて、各チームが「練習しとくね！」と宣言。

**関連機能**: F-004-02, F-004-03, F-003-03

### US-010: オフライン環境でのテスト実施

> **ペルソナ**: 花子さん（75歳）
> **ストーリー**: 花子さんの自宅のWi-Fiが一時的に不通。しかしアプリを開くとデイリーチャレンジが表示される（事前にキャッシュ済み）。オフラインでテストを完了し、スコアが表示される。Wi-Fi復旧後、自動的にデータがサーバーに同期され、ファミリーダッシュボードにも反映される。

**関連機能**: F-002-07, F-003-01（オフライン対応はPWA基盤で実現）

---

## 4. 画面一覧

| 画面ID | 画面名 | 概要 | 主要機能 | 優先度 |
|--------|--------|------|----------|--------|
| S-001 | スプラッシュ画面 | アプリ起動時のブランドロゴ + キャラクター表示 | ロード状態表示 | P0 |
| S-002 | オンボーディング画面 (1-5) | 初回利用時のステップバイステップガイド | F-001-04 | P0 |
| S-003 | ログイン画面 | メール/SNSログイン | F-001-01 | P0 |
| S-004 | 新規登録画面 | アカウント作成フロー | F-001-01 | P0 |
| S-005 | ホーム画面 | キャラクター + 今日のチャレンジ + クイックアクセス | F-002-07, F-006-01 | P0 |
| S-006 | デイリーチャレンジ画面 | テスト出題・回答UI | F-002-01〜05 | P0 |
| S-007 | テスト結果画面 | スコア表示 + キャラクターリアクション + 共有 | F-003-01, F-005-01 | P0 |
| S-008 | スコア履歴画面 | グラフ + レーダーチャート + トレンド | F-003-02 | P0 |
| S-009 | ファミリーダッシュボード | 家族一覧 + 状態表示 | F-004-01 | P0 |
| S-010 | ファミリーランキング画面 | 各種ランキング表示 | F-004-02, F-004-03 | P1 |
| S-011 | メッセージ画面 | スタンプ + ボイスメッセージ | F-005-01, F-005-02 | P1 |
| S-012 | バッジコレクション画面 | 獲得バッジ一覧 + 未獲得バッジ(条件表示) | F-006-03 | P1 |
| S-013 | キャラクター着せ替え画面 | アイテム一覧 + 着せ替えプレビュー | F-006-04 | P2 |
| S-014 | 月次レポート画面 | レポート閲覧 + PDF出力 + メール送信 | F-007-01 | P1 |
| S-015 | プロフィール設定画面 | ユーザー情報 + アバター + 続柄 | F-001-02 | P0 |
| S-016 | ファミリーグループ管理画面 | メンバー管理 + 招待 + 権限設定 | F-001-03 | P0 |
| S-017 | 通知設定画面 | リマインダー + 通知チャネル設定 | F-009-01, F-009-02 | P1 |
| S-018 | アクセシビリティ設定画面 | 文字サイズ + コントラスト + 音声設定 | F-008-01, F-008-02 | P0 |
| S-019 | プライバシー設定画面 | データ管理 + エクスポート + 削除 | F-010-02 | P0 |
| S-020 | ウィークリーチャレンジ画面 | 週間総合テスト | F-002-08 | P2 |

---

## 5. APIエンドポイント一覧

### 認証・ユーザー管理

| メソッド | エンドポイント | 概要 | 認証 |
|---------|---------------|------|------|
| POST | `/api/auth/register` | ユーザー新規登録 | 不要 |
| POST | `/api/auth/login` | ログイン | 不要 |
| POST | `/api/auth/logout` | ログアウト | 要 |
| POST | `/api/auth/refresh` | トークンリフレッシュ | 要 |
| POST | `/api/auth/password-reset` | パスワードリセット要求 | 不要 |
| POST | `/api/auth/social/{provider}` | ソーシャルログイン (google/apple/line) | 不要 |

### プロフィール

| メソッド | エンドポイント | 概要 | 認証 |
|---------|---------------|------|------|
| GET | `/api/users/me` | 自分のプロフィール取得 | 要 |
| PUT | `/api/users/me` | プロフィール更新 | 要 |
| PUT | `/api/users/me/avatar` | アバター更新 | 要 |
| GET | `/api/users/me/settings` | 設定取得 | 要 |
| PUT | `/api/users/me/settings` | 設定更新 | 要 |

### ファミリーグループ

| メソッド | エンドポイント | 概要 | 認証 |
|---------|---------------|------|------|
| POST | `/api/families` | ファミリーグループ作成 | 要 |
| GET | `/api/families` | 所属グループ一覧取得 | 要 |
| GET | `/api/families/{familyId}` | グループ詳細取得 | 要 |
| PUT | `/api/families/{familyId}` | グループ情報更新 | 要(管理者) |
| DELETE | `/api/families/{familyId}` | グループ削除 | 要(管理者) |
| POST | `/api/families/{familyId}/invite` | 招待リンク/QR生成 | 要(管理者) |
| POST | `/api/families/{familyId}/join` | グループ参加 | 要 |
| DELETE | `/api/families/{familyId}/members/{userId}` | メンバー削除 | 要(管理者) |
| PUT | `/api/families/{familyId}/members/{userId}/permissions` | 閲覧権限設定 | 要(管理者) |

### テスト・チャレンジ

| メソッド | エンドポイント | 概要 | 認証 |
|---------|---------------|------|------|
| GET | `/api/challenges/daily` | デイリーチャレンジ取得 | 要 |
| GET | `/api/challenges/weekly` | ウィークリーチャレンジ取得 | 要 |
| POST | `/api/challenges/{challengeId}/start` | チャレンジ開始 | 要 |
| POST | `/api/challenges/{challengeId}/answer` | 回答送信 | 要 |
| POST | `/api/challenges/{challengeId}/complete` | チャレンジ完了 | 要 |
| GET | `/api/tests/categories` | テストカテゴリ一覧 | 要 |
| GET | `/api/tests/{category}/questions` | カテゴリ別問題取得 | 要 |

### スコア・記録

| メソッド | エンドポイント | 概要 | 認証 |
|---------|---------------|------|------|
| GET | `/api/scores/me` | 自分のスコア履歴取得 | 要 |
| GET | `/api/scores/me/summary` | スコアサマリー（グラフ用） | 要 |
| GET | `/api/scores/me/trend` | トレンドデータ取得 | 要 |
| GET | `/api/scores/me/radar` | レーダーチャートデータ取得 | 要 |
| GET | `/api/scores/family/{familyId}` | ファミリースコア一覧 | 要 |
| GET | `/api/scores/family/{familyId}/ranking` | ファミリーランキング | 要 |
| GET | `/api/scores/family/{familyId}/team-battle` | 世代対抗戦スコア | 要 |
| GET | `/api/scores/average/{ageGroup}` | 年齢別平均スコア | 要 |

### コミュニケーション

| メソッド | エンドポイント | 概要 | 認証 |
|---------|---------------|------|------|
| POST | `/api/messages/stamp` | スタンプ送信 | 要 |
| POST | `/api/messages/voice` | ボイスメッセージ送信 | 要 |
| GET | `/api/messages/family/{familyId}` | メッセージ履歴取得 | 要 |
| GET | `/api/messages/unread` | 未読メッセージ取得 | 要 |
| PUT | `/api/messages/{messageId}/read` | 既読マーク | 要 |

### ゲーミフィケーション

| メソッド | エンドポイント | 概要 | 認証 |
|---------|---------------|------|------|
| GET | `/api/gamification/badges` | バッジ一覧取得 | 要 |
| GET | `/api/gamification/badges/me` | 獲得バッジ一覧 | 要 |
| GET | `/api/gamification/coins/me` | コイン残高取得 | 要 |
| GET | `/api/gamification/streak/me` | 連続記録取得 | 要 |
| GET | `/api/gamification/character/items` | 着せ替えアイテム一覧 | 要 |
| POST | `/api/gamification/character/items/{itemId}/unlock` | アイテム解放 | 要 |
| PUT | `/api/gamification/character/equip` | 着せ替え適用 | 要 |

### レポート

| メソッド | エンドポイント | 概要 | 認証 |
|---------|---------------|------|------|
| GET | `/api/reports/monthly` | 月次レポート取得 | 要 |
| GET | `/api/reports/monthly/{year}/{month}` | 特定月レポート取得 | 要 |
| GET | `/api/reports/monthly/{year}/{month}/pdf` | PDF出力 | 要 |
| POST | `/api/reports/monthly/{year}/{month}/email` | レポートメール送信 | 要 |

### 通知

| メソッド | エンドポイント | 概要 | 認証 |
|---------|---------------|------|------|
| GET | `/api/notifications` | 通知一覧取得 | 要 |
| PUT | `/api/notifications/{notificationId}/read` | 通知既読 | 要 |
| PUT | `/api/notifications/settings` | 通知設定更新 | 要 |
| POST | `/api/notifications/device-token` | デバイストークン登録 | 要 |

### データ管理

| メソッド | エンドポイント | 概要 | 認証 |
|---------|---------------|------|------|
| GET | `/api/data/export` | データエクスポート (JSON/CSV) | 要 |
| DELETE | `/api/data/account` | アカウント削除 | 要 |

### ヘルスチェック

| メソッド | エンドポイント | 概要 | 認証 |
|---------|---------------|------|------|
| GET | `/api/health` | ヘルスチェック | 不要 |

---

## 6. データモデル

### User (ユーザー)

```typescript
interface User {
  id: string;                    // UUID
  email: string;                 // メールアドレス
  displayName: string;           // 表示名
  dateOfBirth: string;           // 生年月日 (YYYY-MM-DD)
  ageGroup: AgeGroup;            // 年齢層 (kids/junior/standard/senior/senior_plus)
  avatarUrl: string | null;      // アバター画像URL
  avatarPreset: string | null;   // プリセットアバターID
  relationship: Relationship;    // 続柄
  handedness: 'left' | 'right';  // 利き手
  authProvider: AuthProvider;    // 認証プロバイダ
  settings: UserSettings;        // ユーザー設定
  createdAt: string;             // 作成日時
  updatedAt: string;             // 更新日時
}

type AgeGroup = 'kids' | 'junior' | 'standard' | 'senior' | 'senior_plus';
type Relationship = 'grandfather' | 'grandmother' | 'father' | 'mother'
  | 'son' | 'daughter' | 'grandson' | 'granddaughter' | 'other';
type AuthProvider = 'email' | 'google' | 'apple' | 'line';
```

### UserSettings (ユーザー設定)

```typescript
interface UserSettings {
  fontSize: 'small' | 'medium' | 'large' | 'xlarge';
  highContrast: boolean;
  darkMode: boolean;
  simpleUiMode: boolean;
  voiceGuide: boolean;
  reminderTime: string;          // HH:mm
  reminderDays: number[];        // 0-6 (日-土)
  notificationEnabled: boolean;
  locale: string;                // ja
}
```

### Family (ファミリーグループ)

```typescript
interface Family {
  id: string;                    // UUID
  name: string;                  // グループ名
  iconUrl: string | null;        // グループアイコン
  inviteCode: string;            // 招待コード (6桁英数字)
  ownerId: string;               // 管理者ユーザーID
  members: FamilyMember[];       // メンバー一覧
  createdAt: string;
  updatedAt: string;
}

interface FamilyMember {
  userId: string;
  role: 'owner' | 'member';
  joinedAt: string;
  permissions: MemberPermissions;
}

interface MemberPermissions {
  scoreVisibility: 'full' | 'score_only' | 'hidden';
  notifyOnComplete: boolean;
  notifyOnInactive: boolean;
}
```

### Challenge (チャレンジ)

```typescript
interface Challenge {
  id: string;                    // UUID
  type: 'daily' | 'weekly';     // チャレンジ種別
  date: string;                  // 対象日 (YYYY-MM-DD)
  questions: Question[];         // 出題リスト
  status: 'pending' | 'in_progress' | 'completed';
  startedAt: string | null;
  completedAt: string | null;
}

interface Question {
  id: string;
  category: TestCategory;       // テストカテゴリ
  type: QuestionType;           // 問題タイプ
  difficulty: DifficultyLevel;  // 難易度
  content: QuestionContent;     // 問題内容 (JSON)
  timeLimit: number;            // 制限時間 (秒)
}

type TestCategory = 'memory' | 'attention' | 'language' | 'calculation' | 'spatial';
type QuestionType =
  | 'card_matching' | 'word_memory' | 'story_memory'           // 記憶力
  | 'spot_difference' | 'stroop' | 'reaction_time'             // 注意力
  | 'shiritori' | 'anagram' | 'word_association'                // 言語力
  | 'mental_arithmetic' | 'number_sequence'                     // 計算力
  | 'jigsaw_puzzle' | 'shape_rotation';                         // 空間認識
type DifficultyLevel = 1 | 2 | 3 | 4 | 5;
```

### Score (スコア)

```typescript
interface Score {
  id: string;                    // UUID
  userId: string;                // ユーザーID
  challengeId: string;           // チャレンジID
  date: string;                  // 実施日 (YYYY-MM-DD)
  totalScore: number;            // 総合スコア (0-100)
  categoryScores: CategoryScores;// カテゴリ別スコア
  details: ScoreDetail[];        // 問題別詳細
  createdAt: string;
}

interface CategoryScores {
  memory: number;                // 記憶力 (0-100)
  attention: number;             // 注意力 (0-100)
  language: number;              // 言語力 (0-100)
  calculation: number;           // 計算力 (0-100)
  spatial: number;               // 空間認識 (0-100)
}

interface ScoreDetail {
  questionId: string;
  category: TestCategory;
  isCorrect: boolean;
  responseTime: number;          // 回答時間 (ミリ秒)
  score: number;                 // 得点
  maxScore: number;              // 満点
}
```

### DifficultyProfile (難易度プロファイル)

```typescript
interface DifficultyProfile {
  userId: string;
  levels: Record<TestCategory, DifficultyLevel>;
  history: DifficultyChange[];
  updatedAt: string;
}

interface DifficultyChange {
  category: TestCategory;
  fromLevel: DifficultyLevel;
  toLevel: DifficultyLevel;
  reason: 'auto_up' | 'auto_down' | 'manual';
  changedAt: string;
}
```

### Message (メッセージ)

```typescript
interface Message {
  id: string;                    // UUID
  familyId: string;              // ファミリーグループID
  senderId: string;              // 送信者ユーザーID
  recipientId: string | null;    // 受信者ID (null = グループ全体)
  type: 'stamp' | 'voice' | 'auto_notification';
  content: StampContent | VoiceContent | NotificationContent;
  isRead: boolean;
  createdAt: string;
}

interface StampContent {
  stampId: string;               // スタンプID
  stampCategory: string;         // カテゴリ
}

interface VoiceContent {
  audioUrl: string;              // 音声ファイルURL
  duration: number;              // 長さ (秒)
}

interface NotificationContent {
  templateId: string;            // テンプレートID
  params: Record<string, string>;// テンプレートパラメータ
}
```

### Badge (バッジ)

```typescript
interface Badge {
  id: string;                    // UUID
  name: string;                  // バッジ名
  description: string;           // 獲得条件説明
  iconUrl: string;               // バッジアイコンURL
  category: 'streak' | 'score' | 'family' | 'seasonal' | 'special';
  tier: 'bronze' | 'silver' | 'gold';
  condition: BadgeCondition;     // 獲得条件 (JSON)
}

interface UserBadge {
  userId: string;
  badgeId: string;
  earnedAt: string;              // 獲得日時
}
```

### CharacterItem (キャラクターアイテム)

```typescript
interface CharacterItem {
  id: string;                    // UUID
  name: string;                  // アイテム名
  type: 'hat' | 'accessory' | 'background' | 'effect';
  imageUrl: string;              // アイテム画像URL
  cost: number;                  // コイン価格
  isSeasonal: boolean;           // 季節限定フラグ
  availableFrom: string | null;  // 販売開始日
  availableUntil: string | null; // 販売終了日
}

interface UserCharacter {
  userId: string;
  coins: number;                 // 所持コイン
  unlockedItems: string[];       // 解放済みアイテムID
  equippedItems: {
    hat: string | null;
    accessory: string | null;
    background: string | null;
    effect: string | null;
  };
}
```

### MonthlyReport (月次レポート)

```typescript
interface MonthlyReport {
  id: string;                    // UUID
  userId: string;
  year: number;
  month: number;
  totalTestDays: number;         // テスト実施日数
  averageScore: number;          // 月間平均スコア
  categoryAverages: CategoryScores;
  previousMonthComparison: CategoryScores; // 前月比 (+/- 値)
  trend: 'improving' | 'stable' | 'declining';
  bestCategory: TestCategory;
  mostImprovedCategory: TestCategory;
  recommendations: string[];     // 推奨アクション
  generatedAt: string;
}
```

### Notification (通知)

```typescript
interface Notification {
  id: string;                    // UUID
  userId: string;                // 通知先ユーザーID
  type: NotificationType;
  title: string;
  body: string;
  data: Record<string, unknown>; // 追加データ
  isRead: boolean;
  createdAt: string;
}

type NotificationType =
  | 'test_completed'             // テスト完了
  | 'new_record'                 // 新記録
  | 'streak_milestone'           // 連続記録更新
  | 'badge_earned'               // バッジ獲得
  | 'family_reminder'            // 家族見守りリマインダー
  | 'trend_alert'                // トレンドアラート
  | 'daily_reminder'             // デイリーリマインダー
  | 'stamp_received'             // スタンプ受信
  | 'voice_received'             // ボイスメッセージ受信
  | 'report_ready';              // レポート生成完了
```

### Alert (早期警告)

```typescript
interface Alert {
  id: string;                    // UUID
  userId: string;                // 対象ユーザーID
  level: 'caution' | 'warning' | 'attention';
  category: TestCategory | 'overall';
  message: string;
  metrics: {
    currentAverage: number;
    previousAverage: number;
    changePercent: number;
  };
  notifiedUsers: string[];       // 通知済みユーザーID
  status: 'active' | 'resolved';
  createdAt: string;
  resolvedAt: string | null;
}
```

---

## 技術スタック

| カテゴリ | 技術 | 用途 |
|---------|------|------|
| フレームワーク | Next.js 15 (App Router) | フルスタックWebアプリケーション |
| 言語 | TypeScript 5.x | 型安全な開発 |
| スタイリング | Tailwind CSS 4 | ユーティリティファーストCSS |
| コンポーネント | shadcn/ui | アクセシブルなUIコンポーネント |
| アニメーション | motion/react | キャラクター・UI アニメーション |
| 状態管理 | Zustand | 軽量な状態管理 |
| ローカルDB | IndexedDB (idb) | オフラインデータ保持 |
| キャッシュ | localStorage | 設定・軽量データ |
| PWA | next-pwa | オフライン対応・インストール可能 |
| グラフ | Recharts | スコア推移グラフ・レーダーチャート |
| 音声 | Web Audio API | ボイスメッセージ・効果音 |
| カメラ | MediaDevices API | QRスキャン・写真撮影 |
| 通知 | Web Push API | プッシュ通知 |

---

## 非機能要件リファレンス

詳細は `docs/requirements/non-functional.md` を参照。

主要な非機能要件:
- **パフォーマンス**: FCP < 1.8s, LCP < 2.5s, CLS < 0.1
- **アクセシビリティ**: WCAG 2.1 AA準拠
- **オフライン**: PWAによるオフラインファーストアーキテクチャ
- **セキュリティ**: ヘルスデータの暗号化、GDPR/個人情報保護法準拠
- **対応端末**: iOS Safari 15+, Android Chrome 100+, デスクトップChrome/Firefox/Safari

---

## デザイン要件リファレンス

詳細は `docs/requirements/design-requirements.md` を参照。

---

*Phase 1: 要件定義 - 機能要件書*
*CCAGI SDK v3.5.0*
